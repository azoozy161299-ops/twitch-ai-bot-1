import express from "express";
// index.js
// Ø¨ÙˆØª Twitch Ø°ÙƒÙŠ ÙŠØ±Ø¨Ø· Nightbot Ø¨Ù€ ChatGPT Ø¹Ø¨Ø± OpenAI API

import express from "express";
import dotenv from "dotenv";
import { Configuration, OpenAIApi } from "openai";

// ÙŠÙ‚Ø±Ø£ Ù…Ù„Ù .env Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…ÙØªØ§Ø­ Ø¨Ø´ÙƒÙ„ Ø¢Ù…Ù†
dotenv.config();

const app = express();

// ØªÙ…ÙƒÙŠÙ† Ù‚Ø±Ø§Ø¡Ø© Ø¨ÙŠØ§Ù†Ø§Øª POST Ùˆ URL-encoded
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// Ø¥Ø¹Ø¯Ø§Ø¯ OpenAI API Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙØªØ§Ø­ Ù…Ù† .env
const configuration = new Configuration({
  apiKey: process.env.OPENAI_API_KEY
});
const openai = new OpenAIApi(configuration);

// Endpoint Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø³ÙŠØ·: ÙŠØ±Ø¯ Ø¯Ø§Ø¦Ù…Ù‹Ø§ Ø¨Ø±Ø³Ø§Ù„Ø© Ø¬Ø§Ù‡Ø²Ø©
app.get("/", (req, res) => {
  res.send("âœ… Bot is online and ready!");
});

// Endpoint Ù„Ù„Ø±Ø¯ Ø§Ù„Ø°ÙƒÙŠ Ø¹Ù„Ù‰ Ø±Ø³Ø§Ø¦Ù„ Nightbot
app.get("/reply", async (req, res) => {
  const userMessage = req.query.message || "Ù…Ø±Ø­Ø¨Ø§"; // Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙŠ ÙŠÙƒØªØ¨Ù‡Ø§ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯

  try {
    // Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ ChatGPT Ù„Ù„Ø±Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
    const completion = await openai.createChatCompletion({
      model: "gpt-3.5-turbo", // ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ±Ù‡ Ø¥Ù„Ù‰ gpt-4 Ø¥Ø°Ø§ Ù…ØªØ§Ø­ Ù„Ùƒ
      messages: [{ role: "user", content: userMessage }]
    });

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù†Øµ Ø§Ù„Ø±Ø¯ Ù…Ù† ChatGPT
    const reply = completion.data.choices[0].message.content;

    // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø¯ Ø¥Ù„Ù‰ Nightbot Ù„ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø´Ø§Øª
    res.send(reply);

  } catch (error) {
    console.error(error);
    // Ø±Ø³Ø§Ù„Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© ÙÙŠ Ø­Ø§Ù„Ø© Ø­Ø¯ÙˆØ« Ø®Ø·Ø£
    res.send("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø±Ø¯ ðŸ˜¢");
  }
});

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙˆØ±Øª Ø§Ù„Ù…Ø­Ø¯Ø¯ ÙÙŠ Render Ø£Ùˆ 3000 Ù…Ø­Ù„ÙŠÙ‹Ø§
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => console.log(`ðŸš€ Bot running on port ${PORT}`));

